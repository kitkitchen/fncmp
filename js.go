package main

import "fmt"

func js(port string, path string) string {
	return fmt.Sprintf(`(()=>{var s=class{constructor(e){if(this.ws=null,this.addr=void 0,this.key=void 0,this.addr)throw new Error("ws: already connected to server...");if(!e)throw new Error("ws: no address provided...");this.addr=e,this.connect(e)}connect(e){try{this.ws=new WebSocket(e)}catch(t){throw new Error("ws: failed to connect to server...")}this.ws.onopen=function(){},this.ws.onclose=function(){},this.ws.onerror=function(t){},this.ws.onmessage=function(t){let n=JSON.parse(t.data);l.Process(this,n)}}},o=class{constructor(){this.ws=null,this.Dispatch=e=>{if(e){if(!this.ws)throw new Error("ws: not connected to server...");this.ws.send(JSON.stringify(e))}},this.funs={render:e=>{console.log("RENDER:"),console.log(e);let t=null,r=new DOMParser().parseFromString(e.render.html,"text/html").firstChild.getElementsByTagName("body")[0].innerHTML;if(e.render.tag!=""){if(t=this.utils.getElementsByTagName(e.render.tag)[0],!t)return this.Error(e,"element with tag not found: "+e.render.tag)}else if(e.render.target_id!=""){if(t=this.utils.getElementById(e.render.target_id),!t)return this.Error(e,"element with target_id not found: "+e.render.target_id)}else return this.Error(e,"no target or tag specified");if(e.render.inner&&(t.innerHTML=r),e.render.outer&&(t.outerHTML=r),e.render.append){let i=document.createElement("div");i.innerHTML=r,t.appendChild(i)}e.render.prepend&&t.prepend(r),this.Dispatch(this.utils.addEventListeners(e))}},this.utils={parseFormData:(e,t)=>{let n=e.target,r=new FormData(n);return t.event.data=Object.fromEntries(r.entries()),t},getElementById:e=>document.getElementById(e),getElementsByTagName:e=>document.getElementsByTagName(e),getElementByClassName:e=>document.getElementsByClassName(e),getElementByAttribute:e=>document.querySelectorAll("[".concat(e,"]")),trackTouch:e=>{e.addEventListener("touchstart",t=>{t.preventDefault(),e.classList.add("touch")}),e.addEventListener("touchend",t=>{e.classList.remove("touch")})},addEventListeners:e=>{e.render.event_listeners&&e.render.event_listeners.forEach(t=>{console.log("listener: "+t);let n=document.getElementById(t.target_id);if(!n){console.log("elem not found"),this.Error(e,"element not found");return}n.firstChild?(console.log("elem has children"),n=n.firstChild):console.log("elem has no children"),console.log("elem with listener: "+n),n.addEventListener(t.on,r=>{switch(r.preventDefault(),console.log("event: "+t.on),e.function="event",e.event=t,t.on){case"submit":e=this.utils.parseFormData(r,e);break;default:break}console.log("EVENT:"),console.log(e),this.Dispatch(e)})})}},this.Error=(e,t)=>{e.function="error",e.error.message=t,this.Dispatch(e)},console.log("API: initialized...")}Process(e,t){switch(this.ws||(this.ws=e),t.function){case"redirect":window.location.href=t.redirect.url;return;case"custom":this.Dispatch(window[t.custom.function](t.custom.data));return;case"render":this.Dispatch(this.funs.render(t));default:break}}};new s("ws://localhost%s%s");var l=new o;})();`, port, path)
}
