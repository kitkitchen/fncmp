package fncmp

import "fmt"

func js(port string, path string) string {
	return fmt.Sprintf(`(()=>{var l=class{constructor(t){if(this.ws=null,this.addr=void 0,this.key=void 0,this.addr)throw new Error("ws: already connected to server...");if(!t)throw new Error("ws: no address provided...");this.addr=t,this.connect(t)}connect(t){try{this.ws=new WebSocket(t)}catch(r){throw new Error("ws: failed to connect to server...")}this.ws.onopen=function(){document.getElementById("fncmp_script").remove()},this.ws.onclose=function(){},this.ws.onerror=function(r){},this.ws.onmessage=function(r){let s=JSON.parse(r.data);b.Process(this,s)}}},c=class{constructor(){this.ws=null,this.Dispatch=t=>{if(t){if(!this.ws)throw new Error("ws: not connected to server...");this.ws.send(JSON.stringify(t))}},this.funs={render:t=>{console.log("RENDER:"),console.log(t);let r=null,n=new DOMParser().parseFromString(t.render.html,"text/html").firstChild.getElementsByTagName("body")[0].innerHTML;if(t.render.tag!=""){if(r=document.getElementsByTagName(t.render.tag)[0],!r)return this.Error(t,"element with tag not found: "+t.render.tag)}else if(t.render.target_id!=""){if(r=document.getElementById(t.render.target_id),!r)return this.Error(t,"element with target_id not found: "+t.render.target_id)}else return this.Error(t,"no target or tag specified");t.render.inner&&(r.innerHTML=n),t.render.outer&&(r.outerHTML=n),t.render.append&&(r.innerHTML+=n),t.render.prepend&&(r.innerHTML=n+r.innerHTML);let u=this.utils.getAttributes(r,"events").map(a=>{console.log(a);let d=JSON.parse(a);if(d)return d}).flat().filter(a=>a!=null);console.log("LISTENERS:"),console.log(u),t.render.event_listeners=u,this.Dispatch(this.utils.addEventListeners(t))}},this.utils={parseFormData:(t,r)=>{let s=t.target,n=new FormData(s);return r.event.data=Object.fromEntries(n.entries()),r},getElementByAttribute:t=>document.querySelectorAll("[".concat(t,"]")),trackTouch:t=>{t.addEventListener("touchstart",r=>{r.preventDefault(),t.classList.add("touch")}),t.addEventListener("touchend",r=>{t.classList.remove("touch")})},getAttributes:(t,r)=>{let s=t.querySelectorAll("[".concat(r,"]"));return Array.from(s).map(n=>n.getAttribute(r))},addEventListeners:t=>{t.render.event_listeners&&t.render.event_listeners.forEach(r=>{console.log("listener: "+r);let s=document.getElementById(r.target_id);if(!s){console.log("elem not found"),this.Error(t,"element not found");return}s.firstChild?(console.log("elem has children"),s=s.firstChild):console.log("elem has no children"),console.log("elem with listener: "+s),s.addEventListener(r.on,n=>{switch(n.preventDefault(),console.log("EVENT LISTENER:"),console.log(r.on),console.log("EVENT:"),console.log(n),console.log("TARGET:"),console.log(n.target),t.function="event",t.event=r,r.on){case"submit":t=this.utils.parseFormData(n,t);break;case"pointerdown":t.event.data=g(n);break;case"drag":t.event.data=m(n);break;case"mousedown":t.event.data=h(n);break;case"keydown":t.event.data=p(n);break;case"change":t.event.data=o(n.target);break;case"touchstart":t.event.data=f(n);break;default:t.event.data=o(n.target)}console.log("DISPATCH:"),console.log(t),this.Dispatch(t)})})}},this.Error=(t,r)=>{t.function="error",t.error.message=r,this.Dispatch(t)},console.log("API: initialized...")}Process(t,r){switch(this.ws||(this.ws=t),r.function){case"redirect":window.location.href=r.redirect.url;return;case"custom":this.Dispatch(window[r.custom.function](r.custom.data));return;case"render":this.Dispatch(this.funs.render(r));default:break}}};function o(e){return{id:e.id||"",name:e.name||"",tagName:e.tagName||"",innerHTML:e.innerHTML||"",outerHTML:e.outerHTML||"",value:e.value||""}}function g(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:o(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,height:e.height,isPrimary:e.isPrimary,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,pointerId:e.pointerId,pointerType:e.pointerType,pressure:e.pressure,relatedTarget:o(e.relatedTarget)}}function f(e){return{changedTouches:Array.from(e.changedTouches).map(t=>i(t)),targetTouches:Array.from(e.targetTouches).map(t=>i(t)),touches:Array.from(e.touches).map(t=>i(t)),layerX:e.layerX,layerY:e.layerY,pageX:e.pageX,pageY:e.pageY}}function i(e){return{clientX:e.clientX,clientY:e.clientY,identifier:e.identifier,pageX:e.pageX,pageY:e.pageY,radiusX:e.radiusX,radiusY:e.radiusY,rotationAngle:e.rotationAngle,screenX:e.screenX,screenY:e.screenY,target:o(e.target)}}function m(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:o(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,relatedTarget:o(e.relatedTarget)}}function h(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:o(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,relatedTarget:o(e.relatedTarget)}}function p(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,cancelable:e.cancelable,code:e.code,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:o(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,isComposing:e.isComposing,key:e.key,location:e.location,metaKey:e.metaKey,repeat:e.repeat,shiftKey:e.shiftKey}}new l("ws://192.168.1.154%s%s");var b=new c;})();`, port, path)
}
