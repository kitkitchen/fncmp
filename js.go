package main

import "fmt"

func js(port string, path string) string {
	return fmt.Sprintf(`(()=>{var s=class{constructor(e){if(this.ws=null,this.addr=void 0,this.key=void 0,this.addr)throw new Error("ws: already connected to server...");if(!e)throw new Error("ws: no address provided...");this.addr=e,this.connect(e)}connect(e){try{this.ws=new WebSocket(e)}catch(t){throw new Error("ws: failed to connect to server...")}this.ws.onopen=function(){},this.ws.onclose=function(){},this.ws.onerror=function(t){},this.ws.onmessage=function(t){let r=JSON.parse(t.data);console.log(r),a.Process(this,r)}}},i=class{constructor(){this.ws=null,this.Dispatch=e=>{if(e){if(!this.ws)throw new Error("ws: not connected to server...");this.ws.send(JSON.stringify(e))}},this.funs={render:e=>{let t=null;if(e.render.tag!=""){if(t=this.utils.getElementsByTagName(e.render.tag)[0],!t)return this.Error(e,"element with tag not found: "+e.render.tag)}else if(e.render.target_id!=""){if(t=this.utils.getElementById(e.render.target_id),!t)return this.Error(e,"element with target_id not found: "+e.render.target_id)}else return this.Error(e,"no target or tag specified");if(!t)return this.Error(e,"element not found");if(e.render.inner){this.utils.replaceElementInner(t,e.render.html);return}if(e.render.outer){this.utils.replaceElementOuter(t,e.render.html);return}if(e.render.append){this.utils.appendElement(t,e.render.html);return}}},this.utils={parseFormData:(e,t)=>{let r=e.target,n=new FormData(r);return t.event.data=Object.fromEntries(n.entries()),t},getElementById:e=>document.getElementById(e),getElementsByTagName:e=>document.getElementsByTagName(e),getElementByClassName:e=>document.getElementsByClassName(e),getElementByAttribute:e=>document.querySelectorAll("[".concat(e,"]")),replaceElementOuter:(e,t)=>{e.outerHTML=t},replaceElementInner:(e,t)=>{e.innerHTML=t},appendElement:(e,t)=>{e.innerHTML+=t},trackTouch:e=>{e.addEventListener("touchstart",t=>{t.preventDefault(),e.classList.add("touch")}),e.addEventListener("touchend",t=>{e.classList.remove("touch")})},addEventListeners:e=>{e.render.event_listeners.forEach(t=>{let r=document.getElementById(t.fn_id);if(!r){this.Error(e,"element not found");return}r.firstChild&&(r=r.firstChild),r.addEventListener(t.on,n=>{switch(n.preventDefault(),console.log("event: "+t.on),e.function="event",e.event=t,t.on){case"submit":e=this.utils.parseFormData(n,e);break;default:break}console.log("EVENT:"),console.log(e),this.Dispatch(e)})})}},this.Error=(e,t)=>{e.function="error",e.error.message=t,this.Dispatch(e)},console.log("API: initialized...")}Process(e,t){switch(this.ws||(this.ws=e),t.function){case"redirect":window.location.href=t.redirect.url;return;case"custom":this.Dispatch(window[t.custom.function](t.custom.data));return;case"render":if(this.Dispatch(this.funs.render(t)),!t.render.event_listeners)return;this.Dispatch(this.utils.addEventListeners(t));return;default:this.Error(t,"invalid function: "+t.function);break}}};new s("ws://localhost%s%s");var a=new i;})();`, port, path)
}
