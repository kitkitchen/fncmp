(()=>{var u=class{constructor(){if(this.ws=null,this.addr=void 0,this.key=void 0,this.addr)throw new Error("ws: already connected to server...");let t=localStorage.getItem("fncmp_key");t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var l=Math.random()*16|0,a=r=="x"?l:l&3|8;return a.toString(16)}),localStorage.setItem("fncmp_key",t)),this.key=t;let n=window.location.pathname.split("");console.log(n);let s="";n[-1]=="/"&&n.pop(),s=n.join(""),s==""&&(s="/main"),console.log(s),this.addr="ws://"+window.location.host+s+"?fncmp_id="+this.key,console.log(this.addr),this.connect()}connect(){try{this.ws=new WebSocket(this.addr)}catch(t){throw new Error("ws: failed to connect to server...")}this.ws.onopen=function(){document.getElementById("fncmp_script").remove()},this.ws.onclose=function(){},this.ws.onerror=function(t){},this.ws.onmessage=function(t){let n=JSON.parse(t.data);b.Process(this,n)}}},d=class{constructor(){this.ws=null,this.Dispatch=t=>{if(t){if(!this.ws)throw new Error("ws: not connected to server...");this.ws.send(JSON.stringify(t))}},this.funs={initialize:t=>{t=this.utils.parseEventListeners(document.body,t),this.Dispatch(this.utils.addEventListeners(t))},render:t=>{console.log("RENDER:"),console.log(t);let n=null,r=new DOMParser().parseFromString(t.render.html,"text/html").firstChild.getElementsByTagName("body")[0].innerHTML;if(t.render.tag!=""){if(n=document.getElementsByTagName(t.render.tag)[0],!n)return this.Error(t,"element with tag not found: "+t.render.tag)}else if(t.render.target_id!=""){if(n=document.getElementById(t.render.target_id),!n)return this.Error(t,"element with target_id not found: "+t.render.target_id)}else return this.Error(t,"no target or tag specified");t.render.inner&&(n.innerHTML=r),t.render.outer&&(n.outerHTML=r),t.render.append&&(n.innerHTML+=r),t.render.prepend&&(n.innerHTML=r+n.innerHTML),t=this.utils.parseEventListeners(n,t),this.Dispatch(this.utils.addEventListeners(t))}},this.utils={parseEventListeners:(t,n)=>{let a=this.utils.getAttributes(t,"events").map(i=>{console.log(i);let g=JSON.parse(i);if(g)return g}).flat().filter(i=>i!=null);return console.log("LISTENERS:"),console.log(a),n.render.event_listeners=a,n},parseFormData:(t,n)=>{let s=t.target,r=new FormData(s);return n.event.data=Object.fromEntries(r.entries()),n},getElementByAttribute:t=>document.querySelectorAll("[".concat(t,"]")),trackTouch:t=>{t.addEventListener("touchstart",n=>{n.preventDefault(),t.classList.add("touch")}),t.addEventListener("touchend",n=>{t.classList.remove("touch")})},getAttributes:(t,n)=>{let s=t.querySelectorAll("[".concat(n,"]"));return Array.from(s).map(r=>r.getAttribute(n))},addEventListeners:t=>{t.render.event_listeners&&t.render.event_listeners.forEach(n=>{console.log("listener: "+n);let s=document.getElementById(n.target_id);if(!s){console.log("elem not found"),this.Error(t,"element not found");return}s.firstChild?(console.log("elem has children"),s=s.firstChild):console.log("elem has no children"),console.log("elem with listener: "+s),s.addEventListener(n.on,r=>{switch(r.preventDefault(),console.log("EVENT LISTENER:"),console.log(n.on),console.log("EVENT:"),console.log(r),console.log("TARGET:"),console.log(r.target),t.function="event",t.event=n,n.on){case"submit":t=this.utils.parseFormData(r,t);break;case"pointerdown":t.event.data=f(r);break;case"drag":t.event.data=h(r);break;case"mousedown":t.event.data=p(r);break;case"keydown":t.event.data=y(r);break;case"change":t.event.data=o(r.target);break;case"touchstart":t.event.data=m(r);break;default:t.event.data=o(r.target)}console.log("DISPATCH:"),console.log(t),this.Dispatch(t)})})}},this.Error=(t,n)=>{t.function="error",t.error.message=n,this.Dispatch(t)},console.log("API: initialized...")}Process(t,n){switch(this.ws||(this.ws=t),n.function){case"initialize":this.Dispatch(this.funs.initialize(n));return;case"redirect":window.location.href=n.redirect.url;return;case"custom":console.log("CUSTOM:"),console.log(n),this.Dispatch(window[n.custom.function](n.custom.data));return;case"render":this.Dispatch(this.funs.render(n));default:break}}};function o(e){return{id:e.id||"",name:e.name||"",tagName:e.tagName||"",innerHTML:e.innerHTML||"",outerHTML:e.outerHTML||"",value:e.value||""}}function f(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:o(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,height:e.height,isPrimary:e.isPrimary,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,pointerId:e.pointerId,pointerType:e.pointerType,pressure:e.pressure,relatedTarget:o(e.relatedTarget)}}function m(e){return{changedTouches:Array.from(e.changedTouches).map(t=>c(t)),targetTouches:Array.from(e.targetTouches).map(t=>c(t)),touches:Array.from(e.touches).map(t=>c(t)),layerX:e.layerX,layerY:e.layerY,pageX:e.pageX,pageY:e.pageY}}function c(e){return{clientX:e.clientX,clientY:e.clientY,identifier:e.identifier,pageX:e.pageX,pageY:e.pageY,radiusX:e.radiusX,radiusY:e.radiusY,rotationAngle:e.rotationAngle,screenX:e.screenX,screenY:e.screenY,target:o(e.target)}}function h(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:o(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,relatedTarget:o(e.relatedTarget)}}function p(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:o(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,relatedTarget:o(e.relatedTarget)}}function y(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,cancelable:e.cancelable,code:e.code,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:o(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,isComposing:e.isComposing,key:e.key,location:e.location,metaKey:e.metaKey,repeat:e.repeat,shiftKey:e.shiftKey}}new u;var b=new d;})();
